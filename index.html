<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gravity: Mission Armed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { font-family: 'JetBrains+Mono', monospace; background-color: #050505; color: #10b981; transition: all 0.5s; }
        .emerald-glow { text-shadow: 0 0 30px rgba(16, 185, 129, 0.5); }
        .red-glow { text-shadow: 0 0 30px rgba(239, 68, 68, 0.5); }
        .armed-border { border-color: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
    </style>
</head>
<body class="min-h-screen p-8 flex flex-col justify-between overflow-hidden">

    <div class="flex justify-between items-start">
        <div class="flex flex-col">
            <p class="text-[10px] uppercase tracking-[0.3em] opacity-40">System State</p>
            <p id="status-text" class="text-xs font-bold uppercase tracking-tighter">Standby_</p>
        </div>
        <div class="text-right">
            <p class="text-[10px] uppercase tracking-[0.3em] opacity-40">Total Session Loss</p>
            <p id="daily-total" class="text-xl font-bold italic text-emerald-400">0.00L</p>
        </div>
    </div>

    <div class="flex-1 flex flex-col items-center justify-center">
        <div id="timer-display" class="text-[28vw] font-black tracking-tighter tabular-nums emerald-glow opacity-20 transition-all">
            0.0
        </div>
        
        <button id="ignition-btn" class="mt-8 px-8 py-4 border-2 border-emerald-500/30 rounded-full font-black text-sm tracking-[0.3em] hover:bg-emerald-500/10 transition-all">
            ARM SYSTEM
        </button>
        
        <p id="speed-indicator" class="text-[10px] uppercase tracking-[0.5em] opacity-30 mt-6">SPD: 0.0 m/s</p>
    </div>

    <script>
        let isArmed = false;
        let isIdling = false;
        let startTime, timerInterval;
        let sessionFuel = 0;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        const ignitionBtn = document.getElementById('ignition-btn');
        const timerDisplay = document.getElementById('timer-display');
        const statusText = document.getElementById('status-text');

        function playSound(freq1, freq2) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(freq1, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(freq2, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        ignitionBtn.addEventListener('click', () => {
            isArmed = !isArmed;
            if (isArmed) {
                ignitionBtn.innerText = "SYSTEM ARMED";
                ignitionBtn.classList.add('armed-border', 'text-emerald-500');
                timerDisplay.classList.remove('opacity-20');
                statusText.innerText = "ACTIVE_SCANNING";
                playSound(440, 880);
            } else {
                if (isIdling) stopIdle();
                ignitionBtn.innerText = "ARM SYSTEM";
                ignitionBtn.classList.remove('armed-border', 'text-emerald-500');
                timerDisplay.classList.add('opacity-20');
                statusText.innerText = "STANDBY_";
                playSound(880, 440);
            }
        });

        function startIdle() {
            if (isIdling || !isArmed) return;
            isIdling = true; startTime = Date.now();
            playSound(880, 440);
            document.body.style.backgroundColor = "#1a0505";
            timerDisplay.className = "text-[28vw] font-black tracking-tighter tabular-nums red-glow text-red-500";
            timerInterval = setInterval(() => {
                timerDisplay.innerText = ((Date.now() - startTime) / 1000).toFixed(1);
            }, 100);
        }

        function stopIdle() {
            if (!isIdling) return;
            isIdling = false; clearInterval(timerInterval);
            playSound(440, 880);
            const dur = parseFloat(timerDisplay.innerText);
            if (dur > 2) {
                sessionFuel += (dur / 3600) * 0.6;
                document.getElementById('daily-total').innerText = sessionFuel.toFixed(3) + 'L';
            }
            document.body.style.backgroundColor = "#050505";
            timerDisplay.className = "text-[28vw] font-black tracking-tighter tabular-nums emerald-glow text-emerald-400";
            timerDisplay.innerText = "0.0";
        }

        navigator.geolocation.watchPosition((p) => {
            const speed = p.coords.speed || 0;
            document.getElementById('speed-indicator').innerText = `SPD: ${speed.toFixed(1)} m/s`;
            if (isArmed) {
                if (speed <= 0.3) startIdle();
                else if (speed > 1.2) stopIdle();
            }
        }, null, { enableHighAccuracy: true });
    </script>
</body>
</html>
